---
- hosts: all
  become: yes
  tasks:
    - name: Tear down existing services
      docker_compose:
        project_src: /opt/marketplace
        state: absent
    
    - name: Copy docker-compose file
      ansible.builtin.copy:
        src: deploy/docker-compose.yml
        dest: /opt/marketplace
        owner: devops
    
    - name: Copy env file
      ansible.builtin.copy:
        src: deploy/.env
        dest: /opt/marketplace
        owner: devops
    
    - name: Pull new images from Nexus
      docker_compose:
        project_src: /opt/marketplace
        pull: true
    
    - name: Start pulled services
      docker_compose:
        project_src: /opt/marketplace
        state: present
